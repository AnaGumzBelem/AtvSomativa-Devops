name: Alerta no Discord

on:
  pull_request:
    branches:
      - main
    types: [opened, closed] # Dispara tanto na abertura quanto no fechamento/merge

jobs:
  send_alert:
    runs-on: ubuntu-latest
    steps:
      - name: Checar cÃ³digo
        uses: actions/checkout@v4

      # Passo de Debug aprimorado
      - name: Debug - Imprimir valores para variÃ¡veis crÃ­ticas
        run: |
          echo "Webhook URL: ${{ secrets.DISCORD_WEBHOOK }}"
          echo "TÃ­tulo do PR: ${{ github.event.pull_request.title }}"
          echo "Mensagem do PR: ${{ github.event.pull_request.body }}"
          echo "Autor do PR: ${{ github.event.pull_request.user.login }}"
          echo "Link do PR: ${{ github.event.pull_request.html_url }}"
          echo "AÃ§Ã£o do PR: ${{ github.event.action }}"
          echo "Merged: ${{ github.event.pull_request.merged }}"

      # Enviar alerta para o Discord
      - name: Enviar alerta para o Discord
        uses: johnnyhuy/actions-discord-git-webhook@main
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          args: >
            ${{ github.event.action == 'opened' && 
            format('ğŸš€ Novo Pull Request aberto!\n**TÃ­tulo:** {0}\n**Autor:** {1}\n**Link:** {2}', github.event.pull_request.title, github.event.pull_request.user.login, github.event.pull_request.html_url) || 
            (github.event.pull_request.merged && 
            format('âœ… Pull Request mergeado!\n**TÃ­tulo:** {0}\n**Autor:** {1}\n**Link:** {2}', github.event.pull_request.title, github.event.pull_request.user.login, github.event.pull_request.html_url) || 
            format('âŒ Pull Request fechado sem merge.\n**TÃ­tulo:** {0}\n**Autor:** {1}\n**Link:** {2}', github.event.pull_request.title, github.event.pull_request.user.login, github.event.pull_request.html_url)) }}
